<!DOCTYPE html>
<html>
    <head>
	
	<title>OpenGeoPhone</title>
	<!-- Appel de la librairie Cordova 2.7.0 -->
	<script type="text/javascript" charset="utf-8" src="js/cordova.js"></script>
    
	<!-- Appel du style et de la librairie JQuery Mobile -->
	<link rel="stylesheet" href="css/jquery.mobile-1.3.1.min.css" />
	<script src="js/jquery-1.9.1.min.js"></script>
	<script src="js/jquery.mobile-1.3.1.min.js"></script>

	<!-- Script qui permet la configuration du lien du serveur distant -->
	<script type="text/JavaScript" charset="utf-8" src="js/DMS.Mobile.Login.js"></script>
	
	
	<!-- Chargement du css -->
	<link rel="stylesheet" href="css/style.css" />
	
	<script type="text/JavaScript" charset="utf-8">
	
	var DB = null;

 	 


  function InitConnection() {
			        DB = window.openDatabase("BaseDeDonnées", "1.0.0", "OpenGeophone", 100000);
			        DB.transaction(CreateTableInBD, CreateTableError,successCB); 
           }
  
  function CreateTableError(err)
  {
            alert("CreateTableError : " + err.message);    
  }
  

  function CreateTableInBD(requete, err)
  {
		
  	try{
       		requete.executeSql("CREATE TABLE IF NOT EXISTS TypeMissions ("+
							"TypeMissionID INTEGER  NOT NULL PRIMARY KEY AUTOINCREMENT,"+
							"Titre NVARCHAR(500)  NULL"+
							")");
       
           requete.executeSql( "CREATE TABLE IF NOT EXISTS [Client] ("+
								"[ClientID] INTEGER  NOT NULL PRIMARY KEY AUTOINCREMENT,"+
								"[NomResponsable] NVARCHAR(50)  NOT NULL,"+
								"[NomSociete] NVARCHAR(50)  NULL,"+
								"[RaisonSocial] NVARCHAR(50)  NULL,"+
								"[Tel] INTEGER  NULL,"+
								"[Fax] INTEGER  NULL,"+
								"[UrlWeb] NVARCHAR(300)  NULL,"+
								"[Email] NVARCHAR(50)  NULL,"+
								"[ImageIDClient] INTEGER  NULL,"+
								"[EtatClient] INTEGER  NOT NULL,"+
								"[Synch] BOOLEAN DEFAULT 'True' NOT NULL,"+
								
								"[ActiviteID] TEXT  NULL"+
								")");
								
			 requete.executeSql("CREATE TABLE IF NOT EXISTS [Familles] ("+
						"[FamilleID] INTEGER  PRIMARY KEY NOT NULL,"+
						"[Designation] NVARCHAR(100)  NOT NULL,"+
						"[GammeID] INTEGER  NOT NULL,"+
						"[Synch] BOOLEAN DEFAULT 'True' NOT NULL,"+
						
					    "FOREIGN KEY(GammeID) REFERENCES Gammes(GammeID)"+
						
						")");	
									
		  requete.executeSql(	
									
								"CREATE TABLE IF NOT EXISTS [Gammes] ("+
								"[GammeID] INTEGER  PRIMARY KEY AUTOINCREMENT NOT NULL,"+
								"[Designation] NVARCHAR(100)  NOT NULL,"+
								"[Synch] BOOLEAN DEFAULT 'True' NOT NULL"+
								")");	
								
			requete.executeSql(	"CREATE TABLE IF NOT EXISTS [MissionCommande] ("+
								"[MissionID] INTEGER  NOT NULL PRIMARY KEY"+
								")");	
								
		  requete.executeSql("	CREATE TABLE IF NOT EXISTS [Profils] ("+
								"[ProfilID] INTEGER  NOT NULL PRIMARY KEY AUTOINCREMENT,"+
								"[Designation] NVARCHAR(50)  NULL,"+
								"[Descriptino] TEXT  NULL,"+
								"[Synch] BOOLEAN DEFAULT 'True' NOT NULL"+
							")"	);

	     	 requete.executeSql( "CREATE TABLE IF NOT EXISTS [Personnel] ("+
								"[PersonnelID] INTEGER  PRIMARY KEY AUTOINCREMENT NOT NULL,"+
								"[Password] NVARCHAR(50)  NULL,"+
								"[Nom] NVARCHAR(50)  NULL,"+
								"[Prenom] NVARCHAR(50)  NULL,"+
								"[Tel] INTEGER  NULL,"+
								"[Email] NVARCHAR(50)  NULL,"+
								"[Adresse] NVARCHAR(50)  NULL,"+
								"[Matricule] INTEGER  NULL,"+
								"[Synch] BOOLEAN DEFAULT 'True' NOT NULL,"+
								"[ProfilID] INTEGER  NULL,"+
								"FOREIGN KEY(ProfilID) REFERENCES Profils(ProfilID)"+
								")");	
								
		requete.executeSql(		"CREATE TABLE IF NOT EXISTS [PointVentes] ("+
									"[PointVenteID] INTEGER  PRIMARY KEY AUTOINCREMENT NOT NULL,"	+
								"[Latitude] VARCHAR(50)  NULL,"+
								"[Longitude] VARCHAR(50)  NULL,"+
								"[EtatPointVente] INTEGER  NOT NULL,"+
								"[Responsable] NVARCHAR(50)  NOT NULL,"+
								"[Adresse] NVARCHAR(200)  NULL,"+
								"[Tel] INTEGER  NULL,"+
								"[Fax] INTEGER  NULL,"+
								"[Email] NVARCHAR(50)  NULL,"+
								"[Synch] BOOLEAN DEFAULT 'True' NOT NULL,"+
								
								"[VilleID] INTEGER  NULL,"+
								"[ClientID] INTEGER  NOT NULL,"+
								"FOREIGN KEY(ClientID) REFERENCES Client(ClientID)"+
								")");	
	
							
		requete.executeSql(	"	CREATE TABLE IF NOT EXISTS [Tournees] ("+
								"[TourneeID] INTEGER  PRIMARY KEY AUTOINCREMENT NOT NULL,"+
								"[DateDebut] NUMERIC  NULL,"+
								"[DateFin] NUMERIC  NULL,"+
								"[DateCreation] NUMERIC  NULL,"+
								"[EtatTournee] INTEGER  NOT NULL,"+
								"[Synch] BOOLEAN DEFAULT 'True' NOT NULL,"+
								"[TerminalID] INTEGER  NULL,"+
								"[ImpimanteID] INTEGER  NULL,"+
								"[EquipementID] INTEGER  NULL,"+
								"[VehiculeID] INTEGER  NULL,"+
								
								"[PersonnelID] INTEGER  NOT NULL,"+
								"FOREIGN KEY(PersonnelID) REFERENCES Personnel(PersonnelID)"+
							")"	);

		  requete.executeSql( "CREATE TABLE IF NOT EXISTS [Commandes] ("+
									"[CAB] VARCHAR(30)  NOT NULL,"+
									"[DateCreation] DATE  NOT NULL,"+
									"[DateLivraisonPrevue] DATE  NOT NULL,"+
									"[EtatCommande] INTEGER  NOT NULL,"+
									
									"[PrixTotalTTC] FLOAT  NOT NULL,"+
									"[PrixTotalHT] FLOAT  NOT NULL,"+
									"[TotalTVA] TEXT  NULL,"+
									"[CodeCommande] NVARCHAR(50)  NULL,"+
									"[CommandeID] INTEGER  PRIMARY KEY AUTOINCREMENT NOT NULL,"+
									"[Synch] BOOLEAN DEFAULT 'True' NOT NULL,"+
									"[CommercialID] INTEGER  NOT NULL,"+
									"[PointVenteID] INTEGER  NOT NULL,"+
									
									"FOREIGN KEY(CommercialID) REFERENCES Personnel(PersonnelID),"+
									"FOREIGN KEY(PointVenteID) REFERENCES PointVentes(PointVenteID)"+
								   ")");			



			requete.executeSql( "CREATE TABLE IF NOT EXISTS [Missions] ("+
								"[MissionID] INTEGER  NOT NULL PRIMARY KEY AUTOINCREMENT,"+
								"[EtatMission] INTEGER  NULL,"+
								"[DateCreation] NUMERIC  NOT NULL,"+
								"[DegreUrgence] INTEGER  NULL,"+
								"[DateCloture] NUMERIC  NULL,"+
							    "[Commentaires] TEXT  NULL,"+
								"[TypeMissionID] INTEGER  NOT NULL,"+
								"[Synch] NUMERIC DEFAULT 'True' NOT NULL,"+
								
								"[BCKPersonnelID] INTEGER  NOT NULL,"+
								"[PointVenteID] INTEGER  NOT NULL,"+
								"[TourneeID] INTEGER  NULL,"+
								
								"FOREIGN KEY(BCKPersonnelID) REFERENCES Personnel(PersonnelID),"+
								"FOREIGN KEY(PointVenteID) REFERENCES PointVentes(PointVenteID),"+
								"FOREIGN KEY(TourneeID) REFERENCES Tournees(TourneeID)"+
								")");	
								
								
			requete.executeSql( "CREATE TABLE IF NOT EXISTS [Article] ("+	
			                    "[ArticleID] INTEGER  NOT NULL PRIMARY KEY AUTOINCREMENT,"+
		                     	"[Designation] VARCHAR(50)  NULL,"+
		                        "[PrixUnitaire] FLOAT  NULL,"+
		                        "[CAB] VARCHAR(50)  NULL,"+
		                        "[QteDispo] INTEGER  NULL,"+
		    					"[FamilleID] INTEGER  NOT NULL,"+
		    					"[Synch] NUMERIC DEFAULT 'True' NOT NULL,"+
		                        "FOREIGN KEY(FamilleID) REFERENCES Familles(FamilleID)"+
			")");	
			
			
																							       
        }
       catch(err)
        {
           alert("Exception Create table =" + err.message);
        }
        
        
  }
  
  
function successCB() {
        
        DB.transaction(insertIntoGamme, errorinsertIntoGamme);
        DB.transaction(insertIntoFamille, errorinsertIntoFamille);
        DB.transaction(insertIntoArticle, errorinsertIntoArticle);
        DB.transaction(SelectFromArticle, errorselectFromArticle);
    }
    
    function errorselectFromArticle(err) {
   alert("errorselectFromArticle : " + err.message);   
    }
    
    function SelectFromArticle(requete) {
        
        requete.executeSql('SELECT * FROM Article', [], querySuccess, errorselectFromArticle);
        
        
    }
    
    function Article()
           {
                   var ArticleID;
                   var Designation;
                   var Designation;
                   var PrixUnitaire;
                   var CAB;
                   var QteDispo;
                   var FamilleID;
                   var Synch;
           }
    
    function querySuccess(requete, results) {
        var len = results.rows.length;
        var id;
        
        for (var i=0; i<len; i++){
        alert("Row = " + i + " ID = " + results.rows.item(i).ArticleID + " Data =  " + results.rows.item(i).Designation);
       
       var oArticle = new Article();
        oArticle.ArticleID = results.rows.item(i).ArticleID;
        oArticle.Designation = results.rows.item(i).Designation;
        
        }
       
    }
    
    function insertIntoArticle(requete) {
      
            
            requete.executeSql('INSERT INTO Article (ArticleID, Designation,PrixUnitaire, CAB, QteDispo, FamilleID, Synch) VALUES (1271, "article1", 12, "w4e5r6", 12, 1223, "True")');
            requete.executeSql('INSERT INTO Article (ArticleID, Designation,PrixUnitaire, CAB, QteDispo, FamilleID, Synch) VALUES (1272, "article2", 13, "gzt654", 45, 1223, "True")');
            
      
}
    
  function insertIntoFamille(requete) {
      
            
            requete.executeSql('INSERT INTO Familles (FamilleID, Designation,GammeID, Synch) VALUES (1223, "famille1",1231,"True")');
            requete.executeSql('INSERT INTO Familles (FamilleID, Designation,GammeID, Synch) VALUES (1224, "famille2",1231,"True")');
            
       
}
  function insertIntoGamme(requete) {
      
            requete.executeSql('INSERT INTO Gammes (GammeID, Designation, Synch) VALUES (1231, "gamme1","True")');
            requete.executeSql('INSERT INTO Gammes (GammeID, Designation, Synch) VALUES (1232, "gamme2","True")');
            requete.executeSql('INSERT INTO Gammes (GammeID, Designation, Synch) VALUES (1233, "gamme3","True")');
            requete.executeSql('INSERT INTO Gammes (GammeID, Designation, Synch) VALUES (1234, "gamme4","True")');
            requete.executeSql('INSERT INTO Gammes (GammeID, Designation, Synch) VALUES (1235, "gamme5","True")');
           
      
}

function errorinsertIntoGamme(err) {
   alert("errorinsertIntoGamme : " + err.message);   
    }
    
function errorinsertIntoFamille(err) {
   alert("errorinsertIntoFamille : " + err.message);   
    }
function errorinsertIntoArticle(err) {
   alert("errorinsertIntoArticle : " + err.message);   
    }
    </script>
    
    
    </head>
    <body>
	
	<div data-role="page" id="accueil">
	    
	    <!-- Header -->
	    <div data-role="header">
		<h1>OpenGeoPhone</h1>
		<a id="config" href="#configuration" data-theme="d" class="ui-btn-right">Configuration</a>
	    </div>
	    
	    <!-- Contenu de la page -->
	    <div data-role="content">
		<!-- Affichage de l'état modifié dans le javascript -->
		<div id="etat"></div>
		
		<!-- Affichage des occurences à synchroniser -->
		<div id="synchro"></div>

		<form name="form" action="" method="post" id="form">
		    <label>Nom utilisateur : </label>
			<input id="user" type="text" size="30" value="">
		    <label>Mot de passe :</label>
		    <input id="PasseWord" type="text" size="30" value="">
			
		    <button type="button" name="insert" value="Inserer" id="insert"  >Inserer</button>
		    <button type="button" name="validate" value="Verify" id="verify" >Verifier</button>
		    <input type="button" name="lien1" value="nom du lien" onclick="self.location.href='Article.html'" style="background-color:#3cb371" style="color:white; font-weight:bold"onclick> 
		</form>
		<script type="text/javascript" charset="utf-8">

           
      $(document).ready(function() {
           // put all your jQuery goodness in here.
           document.addEventListener("deviceready", InitConnection , false);
			document.addEventListener("deviceready", InitFormLogin, false);
	
});
			
			
			function InitFormLogin (){
			 
			
			DMS.Mobile.Login.$login = $("#user");
			DMS.Mobile.Login.$password = $("#PassWord");
			DMS.Mobile.Login.connexion = DB;
			DMS.Mobile.Login.$InsertUser = $("#insert");
			DMS.Mobile.Login.$ValidateButton = $("#verify");
			DMS.Mobile.Login.$TestDB = $("#TestDB");
			DMS.Mobile.Login.Initialise();
			}
			
			
		
			
		</script>
	    </div>
	</div>
	
	<!-- Page de configuration du serveur -->
	<div data-role="page" id="configuration">
	    
	    <!-- Header -->
	    <div data-role="header">
		<h1>OpenGeoPhone</h1>
		<a href="#accueil" data-theme="d" class="ui-btn-right">Retour</a>
	    </div>
	    
	    <!-- Contenu de la page -->
	    <div data-role="content">
		<!--
		<form name="form2" action="" method="post" id="form2">
		    <label for="lienserveur">Lien de votre serveur distant :</label>
		    <textarea name="lienserveur" id="lienserveur" maxlength="255"></textarea>
		    <p>Commençant par http:// et finissant par /<br>Exemple: http://extranet.arles.fr/</p>
		    <button type="button" name="maj" value="Mettre à jour" onclick="Lien()">Mettre à jour</button>
		    
		
		</form>
        -->        
                <!-- Affiche le lien serveur actuel -->
                
         <div>
         
         
         
         </div>       
                
		<div id="serveur"></div>
	    </div>
	</div>
    </body>
</html>